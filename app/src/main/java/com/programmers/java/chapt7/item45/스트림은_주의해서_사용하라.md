# Stream API ê°€ ì œê³µí•˜ëŠ” í•µì‹¬ ì¶”ìƒê°œë… ë‘ê°€ì§€

- ìŠ¤íŠ¸ë¦¼ì€, ë°ì´í„° ì›ì†Œì˜ ìœ í•œí•œ or ë¬´í•œí•œ ì‹œí€€ìŠ¤
    - ìŠ¤íŠ¸ë¦¼ì˜ ë°ì´í„°ì›ì†Œ : ê°ì²´ ì°¸ì¡° or Primitive type ê°’
        - ì°¸ê³ ë¡œ int, long, double ë§Œ ì§€ì› (char , float ì§€ì› ì•ˆí•¨ )
- ìŠ¤íŠ¸ë¦¼ íŒŒì´í”„ë¼ì¸ì€, ë°ì´í„° ì›ì†Œë“¤ë¡œ ìˆ˜í–‰ í•˜ëŠ” ì—°ì‚° ë‹¨ê³„

# ìŠ¤íŠ¸ë¦¼ íŒŒì´í”„ ë¼ì¸?

![img.png](img.png)

- ì¤‘ê°„ì—°ì‚°ì€, ìŠ¤íŠ¸ë¦¼ì„ ë³€í™˜í•˜ëŠ” ì—°ì‚°ì´ ì£¼ë¡œ ì˜¨ë‹¤.
    - í•¨ìˆ˜ë¥¼ ì ìš© ( í•˜ì—¬ ë§¤í•‘ )
    - í•„í„°ë§
- ì¢…ë‹¨ ì—°ì‚°ì€, ì¤‘ê°„ ì—°ì‚° ì¤‘, ë§ˆì§€ë§‰ ì¤‘ê°„ì—°ì‚°ì´ ë‚´ë†“ì€ ìŠ¤íŠ¸ë¦¼ì— ìµœí›„ì˜ ì—°ì‚°ì„ ê°€í•œë‹¤.
    - anyFirst()
    - collections
    - ..
- Lazy evaluation ( ì§€ì—° í‰ê°€ ) : ì¦‰, evaluation ì€ â€œì¢…ë‹¨ì—°ì‚°ì´ í˜¸ì¶œ ë  ë•Œ â€œ ì´ë£¨ì–´ì§„ë‹¤ëŠ” ê²ƒìœ¼ë¡œ, ì¢…ë‹¨ ì—°ì‚°ì— ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë°ì´í„° ì›ì†ŒëŠ”, ê³„ì‚°ì— ì“°ì´ì§€ ì•ŠëŠ”ë‹¤.

> ìŠ¤íŠ¸ë¦¼ íŒŒì´í”„ ë¼ì¸ì—ì„œ ì¢…ë‹¨ ì—°ì‚°(terminal operation) ì´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤
>
> - ì—†ìœ¼ë©´ ì¤‘ê°„ ì—°ì‚°ë„ ì‹¤í–‰ ì•ˆë¨
> - ê·¸ë¦¬ê³ , ì¢…ë‹¨ ì—°ì‚°ì€ â€œë‹¨ í•œ ë²ˆ" ë§Œ ì ìš© ê°€ëŠ¥í•¨.
> - Consumer ë¼ê³  ë³¼ ìˆ˜ ìˆê² ì£ ?

---

## ë©”ì†Œë“œ ì²´ì´ë‹

Stream API ì—ì„œëŠ”, ë©”ì†Œë“œ ì²´ì´ë‹ì„ ì§€ì›í•˜ëŠ” fluent API ì´ê¸° ë•Œë¬¸ì—, ì—¬ëŸ¬ ë©”ì†Œë“œ(íŒŒì´í”„)ë“¤ì„ ì²´ì´ë‹ í•˜ì—¬, í•˜ë‚˜ì˜ í‘œí˜„ì‹ìœ¼ë¡œë„ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ( ê·¼ë° ê°€ë…ì„±ì€ ë³´ì¥ ëª»í•˜ì£ ?!!)

## ìŠ¤íŠ¸ë¦¼ íŒŒì´í”„ë¼ì¸

ìŠ¤íŠ¸ë¦¼ íŒŒì´í”„ë¼ì¸ì€ ê¸°ë³¸ì ìœ¼ë¡œ â€œìˆœì°¨ì ìœ¼ë¡œ ìˆ˜í–‰â€ ëœë‹¤.

- ìˆœì°¨ì ì˜ ë°˜ëŒ€ëŠ” ë³‘ë ¬ì´ë¼ê³  ë³¼ ìˆ˜ë„ ìˆì£ .
    - íŒŒì´í”„ë¼ì¸ì„ ë³‘ë ¬ë¡œ ì‹¤í–‰í•˜ë ¤ë©´, íŒŒì´í”„ë¼ì¸ êµ¬ì„± ìŠ¤íŠ¸ë¦¼ ì¤‘ í•˜ë‚˜ì—ì„œ parallel ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•´ì£¼ë©´ ëœë‹¤. ( ì‹¤ì œë¡œ íš¨ê³¼ ë³¼ ìˆ˜ ìˆëŠ” ìƒí™©ì€ ë§ì§€ ì•Šë‹¤ê³ â€¦ )

## ê°€ë…ì„± ì£¼ì˜~~

ìŠ¤íŠ¸ë¦¼ì€ ì˜ëª» ì‚¬ìš©í•˜ë©´ ì½ê¸° ì–´ë µê³  ìœ ì§€ë³´ìˆ˜ë„ ì–´ë µë‹¤.

> ì°¸ê³ 
>
> - computeIfAbsent ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´, ê° key ì— ë‹¤ìˆ˜ì˜ ê°’ì„ ë§¤í•‘í•˜ëŠ” map ì„ ì‰½ê²Œ êµ¬í˜„ ê°€ëŠ¥ ( í•´ë‹¹ í‚¤ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´, ìƒˆë¡œìš´, ë‹¤ì¤‘ê°’ì„ ìœ„í•œ collection ìƒì„± ë©”ì†Œë“œë¥¼ í†µí•´ ì»¬ë ‰ì…˜ ìƒì„±í•˜ì—¬ ë§µì— ë„£ìœ¼ë©´ì„œ, ì´ ì»¬ë ‰ì…˜ì„ ë˜ ë°”ë¡œ ë¦¬í„´í•˜ì—¬, ì—¬ê¸°ì— ë°”ë¡œ add() ê°€ëŠ¥)
>
> ```java
> Map<String,Set<String>> groups;
> 
> groups.computeIfAbsent(alphabetize(word),
> 	(unused) -> new TreeSet<>()).add(word)
> ```
>

ë”°ë¼ì„œ ê°€ë…ì„±ì„ ìœ„í•´ì„œëŠ”

- ì˜ë¯¸ìˆëŠ” ìŠ¤íŠ¸ë¦¼ ë³€ìˆ˜ ( ì´ì ëŒë‹¤ ë§¥ë³€ìˆ˜ ) ë„¤ì´ë°!!
    - ëŒë‹¤ì—ì„  íƒ€ì…ì„ ìì£¼ ìƒëµí•˜ë¯€ë¡œ, ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì„ ì˜ ì§€ì–´ì•¼ ìŠ¤íŠ¸ë¦¼ íŒŒì´í”„ë¼ì¸ì˜ ê°€ë…ì„±ì„ ìœ ì§€í•œë‹¤.

    ```java
    v -> v.discount() ë³´ë‹¤ëŠ”
    voucher -> voucher.discount() ê°€ í›¨ì”¬ ê°€ë…ì„±ì´ ì¢‹ê² ì£ ?
    ```

- ìŠ¤íŠ¸ë¦¼ ë¦¬í„´ ë©”ì†Œë“œëŠ” ì´ì™•ì´ë©´ â€œë³µìˆ˜ëª…ì‚¬â€ë¡œ ë„¤ì´ë°

    ```java
    static Stream<BigInteger> primes() {
    	return Stream.iterate(TWO, BigInteger::newtProbablePrime);
    }
    ```

- ë„ìš°ë¯¸ ë©”ì†Œë“œë¥¼ ì˜ í™œìš© í•˜ì!!!
    - ì¼ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë¡œì§ì€, ë”°ë¡œ ë©”ì†Œë“œë¡œ ë¹¼ë‚´ì„œ ì´ë¥¼ ìŠ¤íŠ¸ë¦¼ ë‚´ì—ì„œ ì‚¬ìš©í•˜ë©´ ê°€ë…ì„±ì´ ë” ì¢‹ì•„ì§„ë‹¤!

â™»ï¸Â ë„ìš°ë¯¸ ë©”ì†Œë“œ ì˜ˆì‹œ )

- ë‚´ë¶€ì—ì„œ ë©”ì†Œë“œ í˜¸ì¶œ í•˜ë‚˜ë§Œìœ¼ë¡œë„ ìŠ¤íŠ¸ë¦¼ ì½”ë“œê°€ ë”ëŸ¬ì›Œì§ˆ ìˆ˜ ìˆìŠ´ë‹¤

```java
		Optional.ofNullable(createPostRequest.images())
			.orElse(Collections.emptyList()).stream()
			.map(img -> PostImageFile.toImage(post.getId(), img, order.order()))
			.map(file -> postImageRepository.save(
				new PostImage(
					post,
					imageUpload.upload(file)
				)
			));

// upload í•˜ëŠ” ë¶€ë¶„ë§Œ ë„ìš°ë¯¸ ë©”ì†Œë“œë¡œ ë¹¼ë‚´ì£¼ê¸°ë§Œ í•´ë„ ì•„ë˜ì™€ ê°™ì´ ë©ë‹ˆë‹¤
		Optional.ofNullable(createPostRequest.images())
			.orElse(Collections.emptyList()).stream()
			.map(img -> PostImageFile.toImage(post.getId(), img, order.order()))
			.map(file -> uploadFile(post, file));
```

## char ê°’ ì²˜ë¦¬ì— ìŠ¤íŠ¸ë¦¼ì„ ì‚¬ìš©í•˜ì§€ ë§ì

ìë°”ëŠ” ê¸°ë³¸íƒ€ì…ì¸ char ì— ëŒ€í•œ ìŠ¤íŠ¸ë¦¼ì€ ì§€ì›í•˜ê³  ìˆì§€ ì•Šë‹¤.

- String í´ë˜ìŠ¤ì— chars() ë©”ì†Œë“œê°€ ì¡´ì¬í•˜ëŠ”ë°, ì‚¬ì‹¤ ì´ê±°ëŠ” int ìŠ¤íŠ¸ë¦¼ì´ë‹¤.. char stream ì´ë¼ê³  ìƒê°í•˜ê³  ì‚¬ìš©í–ˆë‹¤ë©´ ë§¤ìš° í—·ê°ˆë¦´ ê²ƒì„.

---

# ë°˜ë³µë¬¸ vs ìŠ¤íŠ¸ë¦¼â€¦.

ë°˜ë³µë¬¸ë„ ëª¨ë‘ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë°”ê¿”ì•¼ í• ê¹Œ???  ***ë…¸ë…¸.. ì—¬ê¸°ì„  ğŸ”†Â ê°€ë…ì„±ì„ í•­ìƒ ìƒê° ğŸ”†***Â í•˜ì !!

ê·¸ë¦¬ê³  **ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ í•˜ì§€ ëª»í•˜ëŠ” ì‘ì—…ë“¤ì´ ì¡´ì¬**í•œë‹¤.

- ë°˜ë³µë¬¸ì€ { }  â† **ì½”ë“œ ë¸”ëŸ­**ì„ ê°€ì ¸ì„œ, í•¨ìˆ˜ê°ì²´ë¡œëŠ” í•  ìˆ˜ ì—†ëŠ” ì¼ë“¤ì„ í•  ìˆ˜ ìˆë‹¤.
    - ì½”ë“œ ë¸”ëŸ­ ë‚´ ì§€ì—­ë³€ìˆ˜ ì„ ì–¸, â€œìˆ˜ì •!â€ ê°€ëŠ¥
        - ë°˜ë©´ ëŒë‹¤ ë‚´ë¶€ì—ì„œëŠ” ê³µìœ ë³€ìˆ˜(ì§€ì—­ ë³€ìˆ˜ ) ì— ëŒ€í•œ ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥ í•˜ë‹¤ ( ë”°ë¼ì„œ ì´ë¥¼ ìœ„í•œ wrapper class ê°€ í•„ìš”í•¨ ) . ì¦‰, ëŒë‹¤ì—ì„  final ë˜ëŠ” â€œì‚¬ì‹¤ìƒ final â€œ ì¸ ë³€ìˆ˜ë§Œ ì½ì„ ìˆ˜ ìˆë‹¤.
    - ë„ì¤‘ì— return, break, throw exception í•˜ê±°ë‚˜, ì›í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì€ continue ë¡œ ê±´ë„ˆë›°ê¸°ê°€ ê°€ëŠ¥.
        - ëŒë‹¤ë¡œëŠ” ìœ„ì˜ ê²ƒë“¤ì´ ë¶ˆê°€ëŠ¥..!

- â™»ï¸Â  ì˜ˆì‹œ ) ëŒë‹¤ ë‚´ë¶€ì—ì„œëŠ” ë³€ìˆ˜ì— ëŒ€í•œ ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•´ì„œ wrapper í´ë˜ìŠ¤ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤
    - ì˜ˆë¥¼ë“¤ì–´ ì•„ë˜ì™€ ê°™ì€ ê²ƒì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤

    ```java
    int order = 0; 
    
    .... 
    	.map(img -> PostImageFile.toImage(post.getId(), img, order++))
    
    ```

    - ë”°ë¼ì„œ Order ë¼ëŠ” ë˜í¼ í´ë˜ìŠ¤ë¥¼ ë‘ëŠ” ê²ƒì„ ê³ ë ¤í•´ ë´ì•¼í•  ê²ƒì…ë‹ˆë‹¤

    ```java
    ....
    	.map(img -> PostImageFile.toImage(post.getId(), img, order.order()))
    ```

    - ë˜ëŠ” ìœ„ì˜ ìƒí™©ì—ì„œëŠ” Java ì˜ AtomicInteger ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤

    ```java
    AtomicInteger order = new AtomicInteger(0);
    
    ....
    	.map(img -> PostImageFile.toImage(savedPost.getId(), img, order.getAndIncrement()))
    ```


ê·¸ëŸ¬ë©´ ìŠ¤íŠ¸ë¦¼ ì–¸ì œì¨ìš”?

- ë°ì´í„° ì‹œí€€ìŠ¤ë“¤ì„ â€œì¼ê´€ë˜ê²Œ ë³€í™˜â€ í•˜ëŠ” ìƒí™© ( ì–´ëŠ í•˜ë‚˜ë§Œ ë³€í™˜í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼, ì¡°ê±´ì— ë§ëŠ” ì›ì†Œë©´ ëª¨ë‘ ê°™ì€ íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•´ì„œ Stream<T> ë¥¼ ë‚´ë±‰ìœ¼ë‹ˆê¹Œ )
- ì‹œí€€ìŠ¤ì— ëŒ€í•œ í•„í„°ë§ì´ í•„ìš”
- ì‹œí€€ìŠ¤ë“¤ì„, ì—°ì‚°ì„ í†µí•´, ê²°í•©í•˜ê³  ì‹¶ì€ ê²½ìš° ( ì‹œí€€ìŠ¤ ë“¤ ë¼ë¦¬ ë§ë¶™ì´ê¸° ê°€ëŠ¥ í•¨ )
- ì‹œí€€ìŠ¤ì˜ ë°ì´í„°ë“¤ì„ ì»¬ë ‰ì…˜ì— ëª¨ìœ¼ë ¤ëŠ” ê²½ìš°
- ì‹œí€€ìŠ¤ì—ì„œ, íŠ¹ì • ì¡°ê±´ ë§Œì¡± ì›ì†Œ ì°¾ëŠ” ê²½ìš°

### ìŠ¤íŠ¸ë¦¼ì„ ì‚¬ìš©í•˜ê¸° ì–´ë ¤ìš´ ë˜ë‹¤ë¥¸ ê²½ìš° : íŒŒì´í”„ë¼ì¸ í†µê³¼ ì „ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ì‹¶ì€ ê²½ìš°.

ì½”ë“œ ë¸”ë¡ì´ ì¡´ì¬í•œë‹¤ë©´, ë³€í™˜ì „ ê°’ì€ ì§€ì—­ë³€ìˆ˜ë¡œì„œ ê°–ê³  ìˆì„ ìˆ˜ ìˆì„í…ë°, ìŠ¤íŠ¸ë¦¼ì„ ì‚¬ìš©í•˜ë©´, ì´ë¯¸ ìŠ¤íŠ¸ë¦¼ ë‚´ì˜ ì›ì†Œê°€ íŒŒì´í”„ë¼ì¸ì„ ê±°ì¹˜ë©° ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ë§¤í•‘ë˜ì–´, ì´ì „ ê°’ì€ ìƒëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤

```java
		public static void main(String[] args) {
        primes().map(p -> TWO.pow(p.intValueExact()).subtract(ONE))
                .filter(mersenne -> mersenne.isProbablePrime(50))
                .limit(20)
								.forEach(System.out::println);
    }
```

- ë”°ë¼ì„œ ì›ë˜ ê°’ì„ ì–»ê³  ì‹¶ë‹¤ë©´, ë‹¤ì‹œ ì´ì „ê°’ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë§¤í•‘ ì„ ë˜ë‹¤ì‹œ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤

ì˜ˆë¥¼ë“¤ì–´ ìœ„ ì˜ˆì‹œì—ì„œëŠ” TWO.pow ë¥¼ í†µí•´ 2^(p.intValueExact()) ë¥¼ ìˆ˜í–‰í•œ í›„ 1ì„ ë¹¼ëŠ” ì—°ì‚°ì„ ìŠ¤íŠ¸ë¦¼ ì›ì†Œ p ì— ì ìš©í•˜ê³  ìˆëŠ”ë°ìš”

p ê°’ì„ ë‹¤ì‹œ ì–»ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ì˜ ë¡œì§ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

> ì°¸ê³ ë¡œ, 2^p  - 1ì´ë¼ëŠ” ê°’ì—ì„œ ì§€ìˆ˜ p ë¥¼ êµ¬í•˜ë ¤ë©´, í•´ë‹¹ ê°’ì„2 ì§„ìˆ˜ë¡œ í‘œí˜„í•œ ë‹¤ìŒ ëª‡ ë¹„íŠ¸ì¸ì§€ ì„¸ì–´ë³´ë©´ ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
>

```java
        primes().map(p -> TWO.pow(p.intValueExact()).subtract(ONE))
                .filter(mersenne -> mersenne.isProbablePrime(50))
                .limit(20)
                .forEach(mp -> System.out.println(mp.bitLength() + ": " + mp));

```

> flatMap (ì œê°€ ì•„ì§ flatMap ì— ìµìˆ™í•˜ì§€ ì•Šì•„ì„œ ë¶€ê°€ì„¤ëª… ì¶”ê°€ ): flatMap ì€ nested Stream êµ¬ì¡°ë¥¼ í”¼í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤ Stream<Stream<R>> ê³¼ ê°™ì€ êµ¬ì¡°ë¥¼ Stream<R> ë¡œ ë§Œë“¤ì–´ë²„ë¦¬ì£ . ì•„ë˜ì—ì„œë„
>
>
> ```java
> private static List<Card> newDeck() {
> 	return Stream.of(Suit.values())
> 		.flatMap( suit ->
> 			Stream.of(Rank.values())
> 				.map(rank -> new Card(suit,rank)) // ì—¬ê¸°ì„œ Stream<Card> ê°€ ìƒê¸°ë‹ˆ , 
> 			// flatMap ì´ ì•„ë‹Œ map ì´ì—ˆë‹¤ë©´ Stream<Stream<Card>> ê°€ ë‚˜ì™”ê² ì£  
> 		).collect(toList());
> ```
>
> [https://blogs.oracle.com/javamagazine/post/java-streams-flatmap-peek](https://blogs.oracle.com/javamagazine/post/java-streams-flatmap-peek)
>
> [https://www.baeldung.com/java-difference-map-and-flatmap](https://www.baeldung.com/java-difference-map-and-flatmap)
>

### ê·¸ëƒ¥ ë‘˜ ë‹¤ í•´ ë³´ê³  ê°€ë…ì„± ì¢‹ì€ ê±°ë¥¼ ì“°ì!!!